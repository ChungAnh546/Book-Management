/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JPanel.java to edit this template
 */
package com.mycompany.quanlynhanvien.ui;

import com.mycompany.quanlynhanvien.Dao.ChiTietHoaDonDao;
import com.mycompany.quanlynhanvien.Dao.HoaDonDao;
import com.mycompany.quanlynhanvien.Dao.KhachHangDao;
import com.mycompany.quanlynhanvien.Dao.NhaCungCapDao;
import com.mycompany.quanlynhanvien.Dao.NhanVienDao;
import com.mycompany.quanlynhanvien.Dao.NhomSanPhamDao;
import com.mycompany.quanlynhanvien.Dao.SanPhamDao;
import com.mycompany.quanlynhanvien.Dao.TacGiaDao;
import com.mycompany.quanlynhanvien.Helpers.ConnectDB;
import com.mycompany.quanlynhanvien.Helpers.DataValidator;
import com.mycompany.quanlynhanvien.Helpers.ImageHelper;
import com.mycompany.quanlynhanvien.Helpers.MessageDialogHelper;
import com.mycompany.quanlynhanvien.Helpers.SharedData;
import com.mycompany.quanlynhanvien.model.ChiTietHoaDon;
import com.mycompany.quanlynhanvien.model.HoaDon;
import com.mycompany.quanlynhanvien.model.KhachHang;
import com.mycompany.quanlynhanvien.model.NhaCungCap;
import com.mycompany.quanlynhanvien.model.NhanVien;
import com.mycompany.quanlynhanvien.model.NhomSanPham;
import com.mycompany.quanlynhanvien.model.SanPham;
import com.mycompany.quanlynhanvien.model.TacGia;
import com.toedter.calendar.JDateChooser;
import java.awt.Color;
import java.awt.Component;
import java.awt.Font;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.HeadlessException;
import java.awt.Image;
import java.awt.image.ImageObserver;
import java.awt.print.PageFormat;
import java.awt.print.Paper;
import java.awt.print.Printable;
import static java.awt.print.Printable.NO_SUCH_PAGE;
import static java.awt.print.Printable.PAGE_EXISTS;
import java.awt.print.PrinterException;
import java.awt.print.PrinterJob;
import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.text.SimpleDateFormat;
import java.time.LocalDate;
import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;
import java.util.Locale;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.ImageIcon;
import javax.swing.JComboBox;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JSpinner;
import javax.swing.JTable;
import javax.swing.JTextField;
import javax.swing.table.DefaultTableModel;
import javax.swing.table.TableCellRenderer;
import javax.swing.table.TableColumn;

/**
 *
 * @author User
 */
public class LapHoaDonForm extends javax.swing.JPanel {

    private DefaultTableModel tblModel;
    private DefaultTableModel tblModelCTHD;
    private DefaultTableModel tblModel_XemCTHD;
    //
     Double totalAmount = 0.0;
    Double cash = 0.0;
    Double balance = 0.0;
    Double bHeight = 0.0;
    HoaDon hoaDonIn = new HoaDon();
    ArrayList<String> itemName = new ArrayList<>();
    ArrayList<String> quantity = new ArrayList<>();
    ArrayList<String> itemPrice = new ArrayList<>();
    ArrayList<String> subtotal = new ArrayList<>();
    List<ChiTietHoaDon> chitiethoadon = new ArrayList<>();
    //
    private byte[] personalImage;
    /**
     * Creates new form LapHoaDonForm
     */
    public LapHoaDonForm() {
        initComponents();
        initTable();
        initTableCTHD();
        loadDataToTable();
        lbl_MaHD.setText(tuDongLayMaHD());
        
        lbl_TenNV.setText(SharedData.nhanVienDN.getTenNhanVien());
        lbl_NgayLap.setText(String.valueOf(LocalDateTime.now()));
        lbl_ThanhTien_LHD.setText("0");
        resetTextFiled(txt_TenSP_QLSP);
        resetTextFiled(txt_MaSP_QLSP);
        resetTextFiled(txt_DonGia_QLSP);

        loadcbxNhomSP(cbx_ChonNhom_QLSP);
        loadcbxNhaCC(cbx_ChonNhaCungCap_QLSP);
        loadcbxTacGia(cbx_ChonTacGia_QLSP);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        pmn_CTHD_LHD = new javax.swing.JPopupMenu();
        mni_Xoa_CTHD = new javax.swing.JMenuItem();
        XemCTHDForm = new javax.swing.JDialog();
        sp_XemCTHD = new javax.swing.JScrollPane();
        tb_XemCTHD = new javax.swing.JTable();
        lbl_MaHD_XemCTHD = new javax.swing.JLabel();
        lbl_TongTien_XemCTHD = new javax.swing.JLabel();
        lbl_TTNV_XemCTHD = new javax.swing.JLabel();
        lbl_TTKH_XemCTHD = new javax.swing.JLabel();
        lbl_NgayLap_XemCTHD = new javax.swing.JLabel();
        pn_LapHD = new javax.swing.JPanel();
        jPanel1 = new javax.swing.JPanel();
        pn_TTSP_QLSP = new javax.swing.JPanel();
        lbl_MaNV_QLSP = new javax.swing.JLabel();
        lbl_TenNV_QLSP = new javax.swing.JLabel();
        lbl_DonGia_QLSP = new javax.swing.JLabel();
        txt_DonGia_QLSP = new javax.swing.JTextField();
        txt_MaSP_QLSP = new javax.swing.JTextField();
        txt_TenSP_QLSP = new javax.swing.JTextField();
        lbl_NhomSP_QLSP = new javax.swing.JLabel();
        cbx_ChonNhom_QLSP = new javax.swing.JComboBox<>();
        lbl_NhaCC_QLSP = new javax.swing.JLabel();
        cbx_ChonNhaCungCap_QLSP = new javax.swing.JComboBox<>();
        lbl_TacGia_QLSP = new javax.swing.JLabel();
        cbx_ChonTacGia_QLSP = new javax.swing.JComboBox<>();
        btn_TimKiem = new javax.swing.JButton();
        scp_DanhSachSP_QLSP = new javax.swing.JScrollPane();
        tbl_DanhSachSP_QLSP = new javax.swing.JTable();
        jPanel2 = new javax.swing.JPanel();
        pn_ThongSoLHD = new javax.swing.JPanel();
        lbl_TieuMaHD = new javax.swing.JLabel();
        lbl_MaHD = new javax.swing.JLabel();
        lbl_TieuNgayLap = new javax.swing.JLabel();
        lbl_TieuTenNV = new javax.swing.JLabel();
        lbl_GhiChu = new javax.swing.JLabel();
        lbl_TenNV = new javax.swing.JLabel();
        btn_Huy = new javax.swing.JButton();
        txt_GhiChu = new javax.swing.JTextField();
        btn_In = new javax.swing.JButton();
        txt_ThongTinKhachHang = new javax.swing.JTextField();
        lbl_TieuThanhTien = new javax.swing.JLabel();
        lbl_ThanhTien_LHD = new javax.swing.JLabel();
        lbl_KhachDua = new javax.swing.JLabel();
        txt_KhachDua = new javax.swing.JTextField();
        lbl_TraLai = new javax.swing.JLabel();
        lbl_GiaTriTL = new javax.swing.JLabel();
        btn_XemTTHD = new javax.swing.JButton();
        btn_ThanhToan = new javax.swing.JButton();
        btn_ThanhToanVaIn = new javax.swing.JButton();
        btn_ThongTinKhachHang = new javax.swing.JButton();
        btn_MayTinh = new javax.swing.JButton();
        lbl_KhachHang = new javax.swing.JLabel();
        lbl_NgayLap = new javax.swing.JLabel();
        scp_CTHD_LHD = new javax.swing.JScrollPane();
        tbl_CTHD_LHD = new javax.swing.JTable();

        mni_Xoa_CTHD.setText("Xóa");
        mni_Xoa_CTHD.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                mni_Xoa_CTHDActionPerformed(evt);
            }
        });
        pmn_CTHD_LHD.add(mni_Xoa_CTHD);

        XemCTHDForm.setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        XemCTHDForm.setBackground(new java.awt.Color(255, 255, 255));
        XemCTHDForm.setMinimumSize(new java.awt.Dimension(400, 460));

        tb_XemCTHD.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String [] {
                "Title 1", "Title 2", "Title 3", "Title 4"
            }
        ));
        sp_XemCTHD.setViewportView(tb_XemCTHD);

        lbl_MaHD_XemCTHD.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        lbl_MaHD_XemCTHD.setText("jLabel1");

        lbl_TongTien_XemCTHD.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        lbl_TongTien_XemCTHD.setText("jLabel1");

        lbl_TTNV_XemCTHD.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        lbl_TTNV_XemCTHD.setText("jLabel1");

        lbl_TTKH_XemCTHD.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        lbl_TTKH_XemCTHD.setText("jLabel1");

        lbl_NgayLap_XemCTHD.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        lbl_NgayLap_XemCTHD.setText("jLabel1");

        javax.swing.GroupLayout XemCTHDFormLayout = new javax.swing.GroupLayout(XemCTHDForm.getContentPane());
        XemCTHDForm.getContentPane().setLayout(XemCTHDFormLayout);
        XemCTHDFormLayout.setHorizontalGroup(
            XemCTHDFormLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(sp_XemCTHD, javax.swing.GroupLayout.DEFAULT_SIZE, 400, Short.MAX_VALUE)
            .addComponent(lbl_MaHD_XemCTHD, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addComponent(lbl_TongTien_XemCTHD, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addComponent(lbl_TTNV_XemCTHD, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addComponent(lbl_TTKH_XemCTHD, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addComponent(lbl_NgayLap_XemCTHD, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        XemCTHDFormLayout.setVerticalGroup(
            XemCTHDFormLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, XemCTHDFormLayout.createSequentialGroup()
                .addComponent(lbl_MaHD_XemCTHD, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(sp_XemCTHD, javax.swing.GroupLayout.PREFERRED_SIZE, 245, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(lbl_TongTien_XemCTHD, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(lbl_TTNV_XemCTHD, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(lbl_TTKH_XemCTHD, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(lbl_NgayLap_XemCTHD, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE))
        );

        setMinimumSize(new java.awt.Dimension(1505, 706));

        jPanel1.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "Thông tin sản phẩm", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Tahoma", 0, 12))); // NOI18N

        pn_TTSP_QLSP.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "Thông tin tìm kiếm", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Tahoma", 0, 12))); // NOI18N
        pn_TTSP_QLSP.addMouseMotionListener(new java.awt.event.MouseMotionAdapter() {
            public void mouseMoved(java.awt.event.MouseEvent evt) {
                pn_TTSP_QLSPMouseMoved(evt);
            }
        });

        lbl_MaNV_QLSP.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        lbl_MaNV_QLSP.setText("Mã sản phẩm:");

        lbl_TenNV_QLSP.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        lbl_TenNV_QLSP.setText("Tên sản phẩm:");

        lbl_DonGia_QLSP.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        lbl_DonGia_QLSP.setText("Đơn giá:");

        txt_DonGia_QLSP.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        txt_DonGia_QLSP.setMinimumSize(new java.awt.Dimension(7, 25));
        txt_DonGia_QLSP.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                txt_DonGia_QLSPFocusGained(evt);
            }
        });
        txt_DonGia_QLSP.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txt_DonGia_QLSPActionPerformed(evt);
            }
        });

        txt_MaSP_QLSP.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        txt_MaSP_QLSP.setMinimumSize(new java.awt.Dimension(7, 25));
        txt_MaSP_QLSP.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                txt_MaSP_QLSPFocusGained(evt);
            }
        });
        txt_MaSP_QLSP.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseExited(java.awt.event.MouseEvent evt) {
                txt_MaSP_QLSPMouseExited(evt);
            }
        });

        txt_TenSP_QLSP.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        txt_TenSP_QLSP.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                txt_TenSP_QLSPFocusGained(evt);
            }
        });

        lbl_NhomSP_QLSP.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        lbl_NhomSP_QLSP.setText("Nhóm sản phẩm:");

        cbx_ChonNhom_QLSP.setEditable(true);
        cbx_ChonNhom_QLSP.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        cbx_ChonNhom_QLSP.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Chọn nhóm", "1", "2", "3" }));
        cbx_ChonNhom_QLSP.addMouseMotionListener(new java.awt.event.MouseMotionAdapter() {
            public void mouseMoved(java.awt.event.MouseEvent evt) {
                cbx_ChonNhom_QLSPMouseMoved(evt);
            }
        });
        cbx_ChonNhom_QLSP.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                cbx_ChonNhom_QLSPFocusGained(evt);
            }
        });
        cbx_ChonNhom_QLSP.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                cbx_ChonNhom_QLSPMouseClicked(evt);
            }
            public void mouseExited(java.awt.event.MouseEvent evt) {
                cbx_ChonNhom_QLSPMouseExited(evt);
            }
        });
        cbx_ChonNhom_QLSP.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbx_ChonNhom_QLSPActionPerformed(evt);
            }
        });

        lbl_NhaCC_QLSP.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        lbl_NhaCC_QLSP.setText("Nhà cung cấp:");

        cbx_ChonNhaCungCap_QLSP.setEditable(true);
        cbx_ChonNhaCungCap_QLSP.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        cbx_ChonNhaCungCap_QLSP.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Chọn nhà cung cấp", "1", "2", "3" }));
        cbx_ChonNhaCungCap_QLSP.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseExited(java.awt.event.MouseEvent evt) {
                cbx_ChonNhaCungCap_QLSPMouseExited(evt);
            }
        });

        lbl_TacGia_QLSP.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        lbl_TacGia_QLSP.setText("Tác giả:");

        cbx_ChonTacGia_QLSP.setEditable(true);
        cbx_ChonTacGia_QLSP.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        cbx_ChonTacGia_QLSP.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Chọn tác giả", "1", "2", "3" }));
        cbx_ChonTacGia_QLSP.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseExited(java.awt.event.MouseEvent evt) {
                cbx_ChonTacGia_QLSPMouseExited(evt);
            }
        });

        btn_TimKiem.setBackground(new java.awt.Color(102, 255, 102));
        btn_TimKiem.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        btn_TimKiem.setIcon(new javax.swing.ImageIcon(getClass().getResource("/com/mycompany/quanlynhanvien/icons/icons8-search-24.png"))); // NOI18N
        btn_TimKiem.setText("Tìm kiếm");
        btn_TimKiem.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_TimKiemActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout pn_TTSP_QLSPLayout = new javax.swing.GroupLayout(pn_TTSP_QLSP);
        pn_TTSP_QLSP.setLayout(pn_TTSP_QLSPLayout);
        pn_TTSP_QLSPLayout.setHorizontalGroup(
            pn_TTSP_QLSPLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pn_TTSP_QLSPLayout.createSequentialGroup()
                .addGroup(pn_TTSP_QLSPLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(btn_TimKiem, javax.swing.GroupLayout.PREFERRED_SIZE, 119, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(pn_TTSP_QLSPLayout.createSequentialGroup()
                        .addGroup(pn_TTSP_QLSPLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(pn_TTSP_QLSPLayout.createSequentialGroup()
                                .addContainerGap()
                                .addComponent(lbl_MaNV_QLSP)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(txt_MaSP_QLSP, javax.swing.GroupLayout.PREFERRED_SIZE, 189, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(pn_TTSP_QLSPLayout.createSequentialGroup()
                                .addGroup(pn_TTSP_QLSPLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addGroup(pn_TTSP_QLSPLayout.createSequentialGroup()
                                        .addGap(13, 13, 13)
                                        .addComponent(lbl_DonGia_QLSP, javax.swing.GroupLayout.PREFERRED_SIZE, 62, javax.swing.GroupLayout.PREFERRED_SIZE))
                                    .addGroup(pn_TTSP_QLSPLayout.createSequentialGroup()
                                        .addContainerGap()
                                        .addComponent(lbl_TenNV_QLSP)))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addGroup(pn_TTSP_QLSPLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                    .addComponent(txt_TenSP_QLSP, javax.swing.GroupLayout.DEFAULT_SIZE, 190, Short.MAX_VALUE)
                                    .addComponent(txt_DonGia_QLSP, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(pn_TTSP_QLSPLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(lbl_NhaCC_QLSP)
                            .addComponent(lbl_NhomSP_QLSP)
                            .addComponent(lbl_TacGia_QLSP))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(pn_TTSP_QLSPLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                            .addComponent(cbx_ChonNhaCungCap_QLSP, javax.swing.GroupLayout.Alignment.LEADING, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(cbx_ChonNhom_QLSP, javax.swing.GroupLayout.Alignment.LEADING, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(cbx_ChonTacGia_QLSP, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))))
                .addContainerGap(15, Short.MAX_VALUE))
        );
        pn_TTSP_QLSPLayout.setVerticalGroup(
            pn_TTSP_QLSPLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pn_TTSP_QLSPLayout.createSequentialGroup()
                .addGap(14, 14, 14)
                .addGroup(pn_TTSP_QLSPLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lbl_MaNV_QLSP)
                    .addComponent(txt_MaSP_QLSP, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lbl_NhomSP_QLSP)
                    .addComponent(cbx_ChonNhom_QLSP, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, Short.MAX_VALUE)
                .addGroup(pn_TTSP_QLSPLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(txt_TenSP_QLSP, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lbl_TenNV_QLSP)
                    .addComponent(lbl_NhaCC_QLSP)
                    .addComponent(cbx_ChonNhaCungCap_QLSP, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addGroup(pn_TTSP_QLSPLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(lbl_DonGia_QLSP)
                    .addComponent(txt_DonGia_QLSP, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(lbl_TacGia_QLSP)
                    .addComponent(cbx_ChonTacGia_QLSP, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(btn_TimKiem, javax.swing.GroupLayout.PREFERRED_SIZE, 29, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(115, 115, 115))
        );

        tbl_DanhSachSP_QLSP.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        tbl_DanhSachSP_QLSP.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null, null},
                {null, null, null, null, null},
                {null, null, null, null, null},
                {null, null, null, null, null},
                {null, null, null, null, null}
            },
            new String [] {
                "Mã NV", "Tên Nhân Viên", "Giới tính", "Ngày sinh", "Số điện thoại"
            }
        ) {
            Class[] types = new Class [] {
                java.lang.String.class, java.lang.String.class, java.lang.String.class, java.lang.String.class, java.lang.String.class
            };
            boolean[] canEdit = new boolean [] {
                true, true, true, true, false
            };

            public Class getColumnClass(int columnIndex) {
                return types [columnIndex];
            }

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        tbl_DanhSachSP_QLSP.setCursor(new java.awt.Cursor(java.awt.Cursor.DEFAULT_CURSOR));
        tbl_DanhSachSP_QLSP.setName("Danh sách nhân viên\n"); // NOI18N
        tbl_DanhSachSP_QLSP.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                tbl_DanhSachSP_QLSPFocusLost(evt);
            }
        });
        tbl_DanhSachSP_QLSP.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                tbl_DanhSachSP_QLSPMouseClicked(evt);
            }
        });
        scp_DanhSachSP_QLSP.setViewportView(tbl_DanhSachSP_QLSP);

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(scp_DanhSachSP_QLSP)
                    .addComponent(pn_TTSP_QLSP, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addContainerGap())
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addComponent(pn_TTSP_QLSP, javax.swing.GroupLayout.PREFERRED_SIZE, 217, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(scp_DanhSachSP_QLSP, javax.swing.GroupLayout.PREFERRED_SIZE, 472, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );

        jPanel2.setBorder(javax.swing.BorderFactory.createTitledBorder(null, "Thông tin hóa đơn", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Tahoma", 0, 12))); // NOI18N

        lbl_TieuMaHD.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        lbl_TieuMaHD.setText("Mã hóa đơn");

        lbl_MaHD.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        lbl_MaHD.setText("HD001");

        lbl_TieuNgayLap.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        lbl_TieuNgayLap.setText("Ngày lập");

        lbl_TieuTenNV.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        lbl_TieuTenNV.setText("Tên nhân viên");

        lbl_GhiChu.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        lbl_GhiChu.setText("Ghi chú");

        lbl_TenNV.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        lbl_TenNV.setText("Chung cute");

        btn_Huy.setBackground(new java.awt.Color(102, 255, 102));
        btn_Huy.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        btn_Huy.setIcon(new javax.swing.ImageIcon(getClass().getResource("/com/mycompany/quanlynhanvien/icons/icons8-x-24.png"))); // NOI18N
        btn_Huy.setText("Hủy");
        btn_Huy.setCursor(new java.awt.Cursor(java.awt.Cursor.DEFAULT_CURSOR));
        btn_Huy.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        btn_Huy.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        btn_Huy.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_HuyActionPerformed(evt);
            }
        });

        txt_GhiChu.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N

        btn_In.setBackground(new java.awt.Color(102, 255, 102));
        btn_In.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        btn_In.setIcon(new javax.swing.ImageIcon(getClass().getResource("/com/mycompany/quanlynhanvien/icons/icons8-printer-24_1.png"))); // NOI18N
        btn_In.setText("In");
        btn_In.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        btn_In.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        btn_In.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_InActionPerformed(evt);
            }
        });

        txt_ThongTinKhachHang.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        txt_ThongTinKhachHang.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseExited(java.awt.event.MouseEvent evt) {
                txt_ThongTinKhachHangMouseExited(evt);
            }
        });
        txt_ThongTinKhachHang.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txt_ThongTinKhachHangActionPerformed(evt);
            }
        });

        lbl_TieuThanhTien.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        lbl_TieuThanhTien.setText("Thành tiền");

        lbl_ThanhTien_LHD.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        lbl_ThanhTien_LHD.setText("10.000");

        lbl_KhachDua.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        lbl_KhachDua.setText("Khách đưa");

        txt_KhachDua.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        txt_KhachDua.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txt_KhachDuaActionPerformed(evt);
            }
        });

        lbl_TraLai.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        lbl_TraLai.setText("Trả lại");

        lbl_GiaTriTL.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        lbl_GiaTriTL.setText("0");

        btn_XemTTHD.setBackground(new java.awt.Color(102, 255, 102));
        btn_XemTTHD.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        btn_XemTTHD.setIcon(new javax.swing.ImageIcon(getClass().getResource("/com/mycompany/quanlynhanvien/icons/icons8-vision-24.png"))); // NOI18N
        btn_XemTTHD.setText("Xem");
        btn_XemTTHD.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        btn_XemTTHD.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        btn_XemTTHD.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_XemTTHDActionPerformed(evt);
            }
        });

        btn_ThanhToan.setBackground(new java.awt.Color(102, 255, 102));
        btn_ThanhToan.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        btn_ThanhToan.setIcon(new javax.swing.ImageIcon(getClass().getResource("/com/mycompany/quanlynhanvien/icons/icons8-money-24_1.png"))); // NOI18N
        btn_ThanhToan.setText("Thanh toán");
        btn_ThanhToan.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        btn_ThanhToan.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        btn_ThanhToan.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_ThanhToanActionPerformed(evt);
            }
        });

        btn_ThanhToanVaIn.setBackground(new java.awt.Color(102, 255, 102));
        btn_ThanhToanVaIn.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        btn_ThanhToanVaIn.setIcon(new javax.swing.ImageIcon(getClass().getResource("/com/mycompany/quanlynhanvien/icons/icons8-printer-24_1.png"))); // NOI18N
        btn_ThanhToanVaIn.setText("Thanh toán và in");
        btn_ThanhToanVaIn.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);
        btn_ThanhToanVaIn.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        btn_ThanhToanVaIn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_ThanhToanVaInActionPerformed(evt);
            }
        });

        btn_ThongTinKhachHang.setBackground(new java.awt.Color(102, 255, 102));
        btn_ThongTinKhachHang.setIcon(new javax.swing.ImageIcon(getClass().getResource("/com/mycompany/quanlynhanvien/icons/icons8-add-24.png"))); // NOI18N
        btn_ThongTinKhachHang.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_ThongTinKhachHangActionPerformed(evt);
            }
        });

        btn_MayTinh.setBackground(new java.awt.Color(102, 255, 102));
        btn_MayTinh.setIcon(new javax.swing.ImageIcon(getClass().getResource("/com/mycompany/quanlynhanvien/icons/icons8-calculator-24.png"))); // NOI18N
        btn_MayTinh.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_MayTinhActionPerformed(evt);
            }
        });

        lbl_KhachHang.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        lbl_KhachHang.setText("Khách hàng");

        lbl_NgayLap.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        lbl_NgayLap.setText("20/10/2021");

        javax.swing.GroupLayout pn_ThongSoLHDLayout = new javax.swing.GroupLayout(pn_ThongSoLHD);
        pn_ThongSoLHD.setLayout(pn_ThongSoLHDLayout);
        pn_ThongSoLHDLayout.setHorizontalGroup(
            pn_ThongSoLHDLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pn_ThongSoLHDLayout.createSequentialGroup()
                .addGroup(pn_ThongSoLHDLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(pn_ThongSoLHDLayout.createSequentialGroup()
                        .addGap(15, 15, 15)
                        .addGroup(pn_ThongSoLHDLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(lbl_GhiChu, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(lbl_TieuTenNV, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(lbl_TieuNgayLap, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(lbl_TieuMaHD, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                        .addGap(47, 47, 47)
                        .addGroup(pn_ThongSoLHDLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(lbl_MaHD, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(lbl_NgayLap, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(lbl_TenNV, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addGroup(pn_ThongSoLHDLayout.createSequentialGroup()
                                .addComponent(txt_GhiChu, javax.swing.GroupLayout.PREFERRED_SIZE, 250, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(0, 0, Short.MAX_VALUE))))
                    .addGroup(pn_ThongSoLHDLayout.createSequentialGroup()
                        .addGap(16, 16, 16)
                        .addComponent(btn_Huy)
                        .addGap(18, 18, 18)
                        .addComponent(btn_In, javax.swing.GroupLayout.PREFERRED_SIZE, 57, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addGroup(pn_ThongSoLHDLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, pn_ThongSoLHDLayout.createSequentialGroup()
                        .addGap(25, 25, 25)
                        .addGroup(pn_ThongSoLHDLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(lbl_TieuThanhTien, javax.swing.GroupLayout.PREFERRED_SIZE, 82, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(lbl_KhachHang, javax.swing.GroupLayout.PREFERRED_SIZE, 82, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(lbl_KhachDua, javax.swing.GroupLayout.PREFERRED_SIZE, 82, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(lbl_TraLai, javax.swing.GroupLayout.PREFERRED_SIZE, 82, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(31, 31, 31)
                        .addGroup(pn_ThongSoLHDLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(pn_ThongSoLHDLayout.createSequentialGroup()
                                .addGroup(pn_ThongSoLHDLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                                    .addComponent(lbl_ThanhTien_LHD, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, 250, Short.MAX_VALUE)
                                    .addComponent(txt_ThongTinKhachHang, javax.swing.GroupLayout.Alignment.LEADING))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(btn_ThongTinKhachHang, javax.swing.GroupLayout.PREFERRED_SIZE, 32, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, pn_ThongSoLHDLayout.createSequentialGroup()
                                .addGroup(pn_ThongSoLHDLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                    .addComponent(lbl_GiaTriTL, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                    .addComponent(txt_KhachDua))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(btn_MayTinh, javax.swing.GroupLayout.PREFERRED_SIZE, 32, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(16, 16, 16))))
                    .addGroup(pn_ThongSoLHDLayout.createSequentialGroup()
                        .addGap(1, 1, 1)
                        .addComponent(btn_XemTTHD)
                        .addGap(36, 36, 36)
                        .addComponent(btn_ThanhToan, javax.swing.GroupLayout.PREFERRED_SIZE, 116, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(36, 36, 36)
                        .addComponent(btn_ThanhToanVaIn, javax.swing.GroupLayout.PREFERRED_SIZE, 164, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(30, 30, 30))))
        );
        pn_ThongSoLHDLayout.setVerticalGroup(
            pn_ThongSoLHDLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pn_ThongSoLHDLayout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGroup(pn_ThongSoLHDLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addGroup(pn_ThongSoLHDLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(txt_ThongTinKhachHang, javax.swing.GroupLayout.DEFAULT_SIZE, 30, Short.MAX_VALUE)
                        .addComponent(lbl_KhachHang, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(lbl_MaHD, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(lbl_TieuMaHD, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(btn_ThongTinKhachHang, javax.swing.GroupLayout.PREFERRED_SIZE, 0, Short.MAX_VALUE))
                .addGap(11, 11, 11)
                .addGroup(pn_ThongSoLHDLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                    .addComponent(lbl_ThanhTien_LHD, javax.swing.GroupLayout.DEFAULT_SIZE, 30, Short.MAX_VALUE)
                    .addComponent(lbl_TieuNgayLap, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(lbl_NgayLap, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(lbl_TieuThanhTien, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(pn_ThongSoLHDLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(btn_MayTinh, javax.swing.GroupLayout.PREFERRED_SIZE, 31, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(pn_ThongSoLHDLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(lbl_TieuTenNV, javax.swing.GroupLayout.PREFERRED_SIZE, 31, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(lbl_TenNV, javax.swing.GroupLayout.PREFERRED_SIZE, 31, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(txt_KhachDua)
                    .addComponent(lbl_KhachDua, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addGap(10, 10, 10)
                .addGroup(pn_ThongSoLHDLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, pn_ThongSoLHDLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(lbl_TraLai, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(txt_GhiChu, javax.swing.GroupLayout.PREFERRED_SIZE, 30, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(lbl_GhiChu, javax.swing.GroupLayout.PREFERRED_SIZE, 31, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(lbl_GiaTriTL, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(pn_ThongSoLHDLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(btn_ThanhToanVaIn, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(btn_ThanhToan, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(btn_XemTTHD, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(btn_In, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(btn_Huy, javax.swing.GroupLayout.DEFAULT_SIZE, 72, Short.MAX_VALUE)))
        );

        tbl_CTHD_LHD.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String [] {
                "Title 1", "Title 2", "Title 3", "Title 4"
            }
        ));
        tbl_CTHD_LHD.setComponentPopupMenu(pmn_CTHD_LHD);
        tbl_CTHD_LHD.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                tbl_CTHD_LHDMouseClicked(evt);
            }
        });
        scp_CTHD_LHD.setViewportView(tbl_CTHD_LHD);

        javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
        jPanel2.setLayout(jPanel2Layout);
        jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel2Layout.createSequentialGroup()
                .addGroup(jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(pn_ThongSoLHD, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.PREFERRED_SIZE, 834, Short.MAX_VALUE)
                    .addComponent(scp_CTHD_LHD))
                .addContainerGap())
        );
        jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel2Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(scp_CTHD_LHD, javax.swing.GroupLayout.PREFERRED_SIZE, 405, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(pn_ThongSoLHD, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );

        javax.swing.GroupLayout pn_LapHDLayout = new javax.swing.GroupLayout(pn_LapHD);
        pn_LapHD.setLayout(pn_LapHDLayout);
        pn_LapHDLayout.setHorizontalGroup(
            pn_LapHDLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pn_LapHDLayout.createSequentialGroup()
                .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addGap(3, 3, 3)
                .addComponent(jPanel2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(51, 51, 51))
        );
        pn_LapHDLayout.setVerticalGroup(
            pn_LapHDLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jPanel1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addGroup(pn_LapHDLayout.createSequentialGroup()
                .addComponent(jPanel2, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addContainerGap())
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 1536, Short.MAX_VALUE)
            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addComponent(pn_LapHD, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 728, Short.MAX_VALUE)
            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addComponent(pn_LapHD, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
    }// </editor-fold>//GEN-END:initComponents
    private void initTable() {

        tblModel = new DefaultTableModel(){

   @Override
   public boolean isCellEditable(int row, int column) {
       //Only the third column
       return column == -1;
   }
};
        tblModel.setColumnIdentifiers(new String[]{"Mã sản phẩm", "Tên sản phẩm", "Số lượng", "Đơn giá", "Hình sản phẩm"});
        
        tbl_DanhSachSP_QLSP.setModel(tblModel);
        tbl_DanhSachSP_QLSP.getColumn("Hình sản phẩm").setCellRenderer(new LapHoaDonForm.myTableCellRenderer());
        
    }
    private void initTableXemCTHD()
    {
        tblModel_XemCTHD = new DefaultTableModel(){

   @Override
   public boolean isCellEditable(int row, int column) {
       //Only the third column
       return column == -1;
   }
};
        tblModel_XemCTHD.setColumnIdentifiers(new String [] {"Mã Sản phẩm","Tên Sản phẩm","Số Lượng","Đơn Giá","Thành Tiền"});
        tb_XemCTHD.setModel(tblModel_XemCTHD);
        
    }
    private void loadDataToTable_XemCTHD(String maHD) {
          try {
            ChiTietHoaDonDao dao = new ChiTietHoaDonDao();
            SanPhamDao daoSP = new SanPhamDao();
            List<ChiTietHoaDon> list = dao.find(maHD);
            tblModel_XemCTHD.setRowCount(0);
            for(ChiTietHoaDon it : list)
            {
                //MessageDialogHelper.showMessageDialog(null, it.getTinhTrang(), "Thông báo");
                tblModel_XemCTHD.addRow(new Object[]
                { it.getSP().getMaSP(),daoSP.find(it.getSP().getMaSP()).getTenSP(),it.getSoluong(),it.getDonGia(),it.getThanhTien()} );
                
                tblModel_XemCTHD.fireTableDataChanged();
            }
        } catch (Exception e) {
            e.printStackTrace();
            MessageDialogHelper.showErrorDialog(null, e.getMessage(), "Lỗi");
                 
        }//To change body of generated methods, choose Tools | Templates.
    }
    private float CapNhapThanhTien()
    {
        int tt = tbl_CTHD_LHD.getRowCount();
        float thanhTien=0;
        if(tt==0)
        {   
            lbl_ThanhTien_LHD.setText(String.valueOf(thanhTien));
            return thanhTien;
        }
        else{
            while(tt!=0)
            {
                //MessageDialogHelper.showConfirmDialog(null, String.valueOf(tt), "Cảnh báo");
                thanhTien =thanhTien +  (float) tbl_CTHD_LHD.getValueAt(tt-1, 5);
                tt--;
              
            }
        }
        lbl_ThanhTien_LHD.setText(String.valueOf(thanhTien));
        return thanhTien;    
        
    }
    private void initTableCTHD() {

        tblModelCTHD = new DefaultTableModel(){

   @Override
   public boolean isCellEditable(int row, int column) {
       //Only the third column
       return column == -1;
   }
};
        tblModelCTHD.setColumnIdentifiers(new String[]{"TT", "Mã sản phẩm", "Tên sản phẩm","Số lượng", "Đơn giá","Thành tiền", "Hình sản phẩm"});
        
        tbl_CTHD_LHD.setModel(tblModelCTHD);
        tbl_CTHD_LHD.getColumn("Hình sản phẩm").setCellRenderer(new LapHoaDonForm.myTableCellRendererCTHD());
        
    }
    private void loadcbxNhomSP(JComboBox<String> cbx) {
        cbx.setBackground(Color.white);
        try {
            NhomSanPhamDao dao = new NhomSanPhamDao();
            List<NhomSanPham> list = dao.findAll();
            cbx.removeAllItems();
            cbx.addItem("Chọn nhóm sản phẩm");
            for (NhomSanPham it : list) {
                cbx.addItem(it.getMaNhomSP().replaceAll("\\s", "") + "-" + it.getTenNhomSP());

            }
        } catch (Exception e) {
            e.printStackTrace();
            MessageDialogHelper.showErrorDialog(null, e.getMessage(), "Lỗi");

        }//To change body of generated methods, choose Tools | Templates.
    }
     class myTableCellRenderer implements TableCellRenderer {

        public Component getTableCellRendererComponent(JTable table, Object value, boolean isSelected, boolean hasFocus, int row, int column) {
            TableColumn tb = tbl_DanhSachSP_QLSP.getColumn("Hình sản phẩm");
            tb.setMaxWidth(150);
            tb.setMinWidth(150);
            tbl_DanhSachSP_QLSP.setRowHeight(150);
            try {
                return (Component) value;
            } catch (Exception e) {
            }
            return null;
        }
    }

     class myTableCellRendererCTHD implements TableCellRenderer {

        public Component getTableCellRendererComponent(JTable table, Object value, boolean isSelected, boolean hasFocus, int row, int column) {
            TableColumn tb = tbl_CTHD_LHD.getColumn("Hình sản phẩm");
            tb.setMaxWidth(150);
            tb.setMinWidth(150);
            tbl_CTHD_LHD.setRowHeight(150);
            try {
                return (Component) value;
            } catch (Exception e) {
            }
            return null;
        }
    }
     public PageFormat getPageFormat(PrinterJob pj)
{
    
    PageFormat pf = pj.defaultPage();
    Paper paper = pf.getPaper();    

    double bodyHeight = bHeight;  
    double headerHeight = 5.0;                  
    double footerHeight = 5.0;        
    double width = cm_to_pp(8); 
    double height = cm_to_pp(headerHeight+bodyHeight+footerHeight); 
    paper.setSize(width, height);
    paper.setImageableArea(0,10,width,height - cm_to_pp(1));  
            
    pf.setOrientation(PageFormat.PORTRAIT);  
    pf.setPaper(paper);    

    return pf;
}
    protected static double cm_to_pp(double cm)
    {            
	        return toPPI(cm * 0.393600787);            
    }
 
    protected static double toPPI(double inch)
    {            
	        return inch * 72d;            
    }
    public class BillPrintable implements Printable {
    
   
    
    
  public int print(Graphics graphics, PageFormat pageFormat,int pageIndex) 
  throws PrinterException 
  {    
      
      int r= chitiethoadon.size();
      ImageIcon icon=new ImageIcon("/com/mycompany/quanlynhanvien/icons/b6508f6a62dfaa81f3ce.jpg"); 
      int result = NO_SUCH_PAGE;    
        if (pageIndex == 0) {                    
        
            Graphics2D g2d = (Graphics2D) graphics;                    
            double width = pageFormat.getImageableWidth();                               
            g2d.translate((int) pageFormat.getImageableX(),(int) pageFormat.getImageableY()); 



          //  FontMetrics metrics=g2d.getFontMetrics(new Font("Arial",Font.BOLD,7));
        
        try{
            int y=20;
            int yShift = 10;
            int headerRectHeight=15;
           // int headerRectHeighta=40;
            NhanVienDao daoNV = new NhanVienDao();
            KhachHangDao daoKH = new KhachHangDao();
            g2d.setFont(new Font("Monospaced",Font.PLAIN,9));
                ImageObserver rootPane = null;
            g2d.drawImage(icon.getImage(), 50, 20, 90, 30, rootPane);y+=yShift+30;
            g2d.drawString("----------------------------------------",12,y);y+=yShift;
            g2d.drawString("         Nhà sách: Trí Tuệ Việt         ",12,y);y+=yShift;
            g2d.drawString("        115f/34b TP. Biên Hòa, ĐN       ",12,y);y+=yShift;
           // g2d.drawString("   Address Line 02 SRI LANKA ",12,y);y+=yShift;
            g2d.drawString("       www.facebook.com/TriTueViet      ",12,y);y+=yShift;
            g2d.drawString("           Phone: 0952353442            ",12,y);y+=yShift;
            
            g2d.drawString("----------------------------------------",12,y);y+=headerRectHeight;
            g2d.drawString("Mã hóa đơn: "+hoaDonIn.getMaHD()+"           ",12,y);y+=yShift;
            g2d.drawString("----------------------------------------",12,y);y+=headerRectHeight;
            g2d.drawString(" Tên sách   SL    Đơn giá     Thành tiền",10,y);y+=yShift;
            g2d.drawString("----------------------------------------",10,y);y+=headerRectHeight;
            SanPhamDao daoSP = new SanPhamDao();
            int i =0;
            for (ChiTietHoaDon it : chitiethoadon) 
            {
            //g2d.drawString(" "+daoSP.find(it.getSP().getMaSP()).getTenSP()  +"                            ",10,y)
            g2d.drawString(" "+(++i)+"."+daoSP.find(it.getSP().getMaSP()).getTenSP(),10,y);y+=yShift;g2d.drawString("   "+String.valueOf(it.getSoluong()),60,y);g2d.drawString("   "+String.valueOf(it.getDonGia()),90,y) ;g2d.drawString("   "+String.valueOf(it.getThanhTien()),160,y);y+=yShift;

            }
          
            g2d.drawString("----------------------------------------",10,y);y+=yShift;
            g2d.drawString(" Tổng tiền: "+String.valueOf(hoaDonIn.getTongTien())+"VND",10,y);y+=yShift;
            g2d.drawString("----------------------------------------",10,y);y+=yShift;
            g2d.drawString(" Thu ngân: "+daoNV.find(hoaDonIn.getNhanVien().getMaNhanVien()).getTenNhanVien()+"  Mã: "+hoaDonIn.getNhanVien().getMaNhanVien(),10,y);y+=yShift;
            g2d.drawString(" Khách hàng: "+daoKH.find(hoaDonIn.getKhachHang().getMaKH()).getTenKH()+"  Mã: "+hoaDonIn.getKhachHang().getMaKH(),10,y);y+=yShift;
            g2d.drawString(" Ngày: "+hoaDonIn.getNgayLap()+"   ",10,y);y+=yShift;
            //g2d.drawString("-------------------------------------",10,y);y+=yShift;
            //g2d.drawString(" Balance   :                 "+/*txtbalance.getText()+*/"   ",10,y);y+=yShift;
  
            g2d.drawString("****************************************",10,y);y+=yShift;
            g2d.drawString("      cảm ơn quý khách đã mua hàng         ",10,y);y+=yShift;
            g2d.drawString("              hẹn gặp lại                  ",10,y);y+=yShift;
            g2d.drawString("****************************************",10,y);y+=yShift;
           // g2d.drawString("       SOFTWARE BY:CODEGUID          ",10,y);y+=yShift;
            //g2d.drawString("   CONTACT: anhchung546@gmail.com    ",10,y);y+=yShift;       
           

    }
    catch(Exception e){
    e.printStackTrace();
    }

              result = PAGE_EXISTS;    
          }    
          return result;    
      }

       
   }
     private void resetTextFiled(JDateChooser field) {
        field.setDate(null);
        field.setBackground(Color.white);//To change body of generated methods, choose Tools | Templates.
    }

    private void resetTextFiled(JTextField field) throws HeadlessException {
        field.setText("");
        field.setBackground(Color.white);
    }
    private void XoaTTIn() throws Exception
    {
        
        
        hoaDonIn = null;
        
        chitiethoadon =  null;
        
    }
    private void setTTIn(String maHD) throws Exception
    {
        
        HoaDonDao daoHD = new HoaDonDao();
        hoaDonIn = daoHD.find(maHD);
        ChiTietHoaDonDao cthdDao = new ChiTietHoaDonDao();
        chitiethoadon =  cthdDao.find(maHD);
        
    }
    private void resetTextFiled(JSpinner field) {
        field.setValue(0);
        field.setBackground(Color.white);//To change body of generated methods, choose Tools | Templates.
    }
     public void loadcbxNhaCC(JComboBox<String> cbx) {
        cbx.setBackground(Color.white);
        try {
            NhaCungCapDao dao = new NhaCungCapDao();
            List<NhaCungCap> list = dao.findAll();
            cbx.removeAllItems();
            cbx.addItem("Chọn nhà cung cấp");

            for (NhaCungCap it : list) {

                cbx.addItem(it.getMaNhaCC().replaceAll("\\s", "") + "-" + it.getTenNhaCC());

            }
        } catch (Exception e) {
            e.printStackTrace();
            MessageDialogHelper.showErrorDialog(null, e.getMessage(), "Lỗi");

        }
    }

    public void loadcbxTacGia(JComboBox<String> cbx) {
        cbx.setBackground(Color.white);
        try {
            TacGiaDao dao = new TacGiaDao();
            List<TacGia> list = dao.findAll();
            cbx.removeAllItems();
            cbx.addItem("Chọn tác giả");
            for (TacGia it : list) {
                cbx.addItem(it.getMaTacGia().replaceAll("\\s", "") + "-" + it.getTenTacGia());

            }
        } catch (Exception e) {
            e.printStackTrace();
            MessageDialogHelper.showErrorDialog(null, e.getMessage(), "Lỗi");

        }
    }

    private void loadDataToTable() {
        try {
            SanPhamDao dao = new SanPhamDao();
            List<SanPham> list = dao.findAll();
            tblModel.setRowCount(0);
            for (SanPham it : list) {
                JLabel lbl = new JLabel();
                //MessageDialogHelper.showMessageDialog(null, it.getTinhTrang(), "Thông báo");
                ImageIcon icon = new ImageIcon();
                if (it.getHinhSP() != null) {
                    //Image img = ImageHelper.CreateImageFromByteArray(nv.getHinh(), "jpg");
                    //lbl_Hinh_CN.setIcon(new ImageIcon(img));
                    //personalImage = nv.getHinh();

                    icon = new ImageIcon(it.getHinhSP());
                    lbl.setIcon(icon);
                } else {
                    // personalImage = nv.getHinh();
                    //ImageIcon icon = new ImageIcon(getClass().getResource("/com/mycompany/quanlynhanvien/icons/Screenshot 2021-11-17 090047.jpg")); 
                    // lbl_Hinh_CN.setIcon(icon);
                    icon = new ImageIcon(getClass().getResource("/com/mycompany/quanlynhanvien/icons/Screenshot 2021-11-17 090047.jpg"));
                    lbl.setIcon(icon);

                }

                tblModel.addRow(new Object[]{it.getMaSP(), it.getTenSP(), it.getSoLuong(), it.getDonGia(), lbl});

                tblModel.fireTableDataChanged();
            }
        } catch (Exception e) {
            e.printStackTrace();
            MessageDialogHelper.showErrorDialog(null, e.getMessage(), "Lỗi");

        }
    }
    private void btn_HuyActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_HuyActionPerformed
        resetTTHD();
    }//GEN-LAST:event_btn_HuyActionPerformed

    private void btn_InActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_InActionPerformed
       String maHD = "" ;
        try {
            
            maHD = JOptionPane.showInputDialog("Nhập mã hóa đơn muốn in");
            
            HoaDonDao daoHD = new HoaDonDao();
            if(!maHD.equals(""))
            {
            if(daoHD.find(maHD)==null)
            {JOptionPane.showMessageDialog(null, "Không tìm thấy hóa đơn");
            return;}
            else
            {
                maHD = daoHD.find(maHD).getMaHD();
            }
            }
        } catch (Exception e) {
        }
        //Xóa nhân viên
        

        //JOptionPane.showMessageDialog(null, maNhanVien==null);
        if(!(maHD==null))
        {
            if(!maHD.equals(""))
            {if(MessageDialogHelper.showConfirmDialog(null, "Bạn có muốn in hóa đơn không?", "Hỏi")==JOptionPane.YES_OPTION)
        {}else{return;}
                try {

                    try {
            setTTIn(maHD);
        } catch (Exception ex) {
            Logger.getLogger(LapHoaDonForm.class.getName()).log(Level.SEVERE, null, ex);
        }
        bHeight = Double.valueOf(chitiethoadon.size());
        //JOptionPane.showMessageDialog(rootPane, bHeight);
        
        PrinterJob pj = PrinterJob.getPrinterJob();        
        pj.setPrintable(new BillPrintable(),getPageFormat(pj));
        try {
             pj.print();
             XoaTTIn();
        }
         catch (PrinterException ex) {
                 ex.printStackTrace();
        }

                } catch (Exception e) {
                    e.printStackTrace();
                    MessageDialogHelper.showErrorDialog( null, e.getMessage()
                        , "Lỗi");
                }
            }
        }
    }//GEN-LAST:event_btn_InActionPerformed

    private void btn_XemTTHDActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_XemTTHDActionPerformed
        try {
            String maHD = "" ;
        try {
            maHD = JOptionPane.showInputDialog("Nhập mã hóa đơn muốn xem");
            
            HoaDonDao daoHD = new HoaDonDao();
            if(!maHD.equals(""))
            {
            if(daoHD.find(maHD)==null)
            {JOptionPane.showMessageDialog(null, "Không tìm thấy hóa đơn");
            return;}
            else
            {
                maHD = daoHD.find(maHD).getMaHD();
            }
            }else{return;}
        } catch (Exception e) {
        }
            HoaDonDao daoHD = new HoaDonDao();
            NhanVienDao daoNV = new NhanVienDao();
            KhachHangDao daoKH = new KhachHangDao();
            HoaDon hd = new HoaDon();
            hd = daoHD.find(maHD);
            if(hd==null){return;}
            XemCTHDForm.setLocationRelativeTo(null);
            XemCTHDForm.setVisible(true);
            initTableXemCTHD();
            loadDataToTable_XemCTHD(maHD);
            
            lbl_MaHD_XemCTHD.setText("Mã Hóa Đơn: "+maHD);
            lbl_TongTien_XemCTHD.setText("Tổng tiền: "+hd.getTongTien());
            lbl_TTNV_XemCTHD.setText("Thu ngân: "+daoNV.find(hd.getNhanVien().getMaNhanVien()).getTenNhanVien()+"  MaNV: "+hd.getNhanVien().getMaNhanVien());
            lbl_TTKH_XemCTHD.setText("Khách hàng: "+daoKH.find(hd.getKhachHang().getMaKH()).getTenKH()+"  MaKH: "+hd.getKhachHang().getMaKH());
            lbl_NgayLap_XemCTHD.setText("Ngày Lập: "+hd.getNgayLap());
        } catch (Exception e) {
            e.printStackTrace();
            MessageDialogHelper.showErrorDialog(null, e.getMessage(), "Lỗi");

        }
    }//GEN-LAST:event_btn_XemTTHDActionPerformed
    private boolean insertCTHD(String maHD) throws Exception
    {
        for (int i = 0 ; i < tbl_CTHD_LHD.getRowCount();i++)
        {
            ChiTietHoaDon cthd = new ChiTietHoaDon();
            cthd.setThanhTien((float) tbl_CTHD_LHD.getValueAt(i, 5));
            cthd.setDonGia((float) tbl_CTHD_LHD.getValueAt(i, 4));
            HoaDon hd = new HoaDon();
            hd.setMaHD(maHD);
            cthd.setHD(hd);
            SanPham sp = new SanPham();
            sp.setMaSP((String) tbl_CTHD_LHD.getValueAt(i, 1));
            cthd.setSP(sp);
            cthd.setSoluong((int) tbl_CTHD_LHD.getValueAt(i, 3));
            ChiTietHoaDonDao dao = new ChiTietHoaDonDao();
            dao.insert(cthd);
        
        }return true;
    }
    private void resetTTHD()
    {
        lbl_TenNV.setText(SharedData.nhanVienDN.getTenNhanVien());
        lbl_NgayLap.setText(String.valueOf(LocalDateTime.now()));
        txt_GhiChu.setText("");
        initTableCTHD();
        txt_ThongTinKhachHang.setText("");
        lbl_MaHD.setText(tuDongLayMaHD());
        lbl_ThanhTien_LHD.setText("0");
        lbl_GiaTriTL.setText("0");
        txt_KhachDua.setText("");
        
    }
    private void CapNhapLaiSP(String maHD)
    {
        try {
            ChiTietHoaDonDao dao = new ChiTietHoaDonDao();
            List<ChiTietHoaDon> list = dao.find(maHD);
            SanPhamDao daoSP = new SanPhamDao();
            SanPham sp =new SanPham();
            int soLuong ;
            for (ChiTietHoaDon it : list) {
               
                sp = daoSP.find(it.getSP().getMaSP());
                soLuong = sp.getSoLuong() - it.getSoluong();
                sp.setSoLuong(soLuong);
                daoSP.update(sp);

                
            }
        } catch (Exception e) {
            e.printStackTrace();
            MessageDialogHelper.showErrorDialog(null, e.getMessage(), "Lỗi");

        }
    }
    private void btn_ThanhToanActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_ThanhToanActionPerformed
        int text = tbl_CTHD_LHD.getRowCount();
        if(text==0)
        {
         MessageDialogHelper.showMessageDialog(null, "Vui lòng chọn sản phẩm", "Thông báo");
         return;
        }
        
        StringBuilder sb = new StringBuilder();
        //MessageDialogHelper.showMessageDialog(null, (String) cbx_MaTK_T.getSelectedItem(), "Thông báo");
        DataValidator.validateEmptyMaKH(txt_ThongTinKhachHang, sb);
        int sLT;
        SanPhamDao daoSP = new SanPhamDao();
        SanPham SPT = new SanPham();
        for(int i = 0;i < text; i++)
        {
            sLT = (int) tbl_CTHD_LHD.getValueAt(i, 3);
            try {
                SPT = daoSP.find((String) tbl_CTHD_LHD.getValueAt(i, 1));
            } catch (Exception ex) {
                Logger.getLogger(LapHoaDonForm.class.getName()).log(Level.SEVERE, null, ex);
            }
            if(sLT>SPT.getSoLuong())
            {MessageDialogHelper.showErrorDialog(null,"Sản phẩm "+ SPT.getTenSP()+" có số lượng tồn không đủ ", "Lỗi");
                return;
            }
        }
        try {
            float TienKD = Float.valueOf(txt_KhachDua.getText());
            if(TienKD>0){
            float TienTra = TienKD - CapNhapThanhTien();
            if(TienTra>=0){
            lbl_GiaTriTL.setText(String.valueOf(TienTra));
            }else
            {MessageDialogHelper.showErrorDialog(null, "Tiền khách đưa chưa đủ", "Lỗi");
            lbl_GiaTriTL.setText("0");
            return;
            }
            }
            else{
            MessageDialogHelper.showErrorDialog(null, "Tiền khách đưa không được âm", "Lỗi");
            return;
            }
        } catch (Exception e) {
            MessageDialogHelper.showErrorDialog(null, "Vui lòng nhập lại tiền khách đưa", "Lỗi");
            return;
        }

        //DataValidator.validateEmptyChucVu(txt_ChucVu_T, sb);
        if (sb.length() > 0) {
            MessageDialogHelper.showErrorDialog(null, sb.toString(), "Lỗi");
            return;
        }

        try {
            HoaDon hd = new HoaDon();
            KhachHangDao daoKH = new KhachHangDao();
            hd.setMaHD(tuDongLayMaHD());
            long millis = System.currentTimeMillis();  
            java.sql.Date date=new java.sql.Date(millis);
            hd.setNgayLap(date);
            String[] maKH = txt_ThongTinKhachHang.getText().split("-");
            hd.setNhanVien(SharedData.nhanVienDN);
            hd.setKhachHang(daoKH.find(maKH[0]));
            hd.setTongTien(CapNhapThanhTien());
            hd.setGhiChu(txt_GhiChu.getText());
            HoaDonDao dao = new HoaDonDao();
            if (dao.insert(hd)&&insertCTHD(hd.getMaHD())) {
                
                MessageDialogHelper.showMessageDialog(null, "Thanh toán thành công, hóa đơn đã được lưu", "Thông báo");
                CapNhapLaiSP(hd.getMaHD());
                loadDataToTable();
                resetTTHD();
                
                
            } else {
                MessageDialogHelper.showConfirmDialog(null, "Thanh toán không thành công do lỗi", "Cảnh báo");

            }
            
            
        } catch (Exception e) {
            e.printStackTrace();
            MessageDialogHelper.showErrorDialog(null, e.getMessage(),
                     "Lỗi");
        }
    }//GEN-LAST:event_btn_ThanhToanActionPerformed

    private void btn_ThanhToanVaInActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_ThanhToanVaInActionPerformed
        int text = tbl_CTHD_LHD.getRowCount();
        if(text==0)
        {
         MessageDialogHelper.showMessageDialog(null, "Vui lòng chọn sản phẩm", "Thông báo");
         return;
        }
        
        StringBuilder sb = new StringBuilder();
        //MessageDialogHelper.showMessageDialog(null, (String) cbx_MaTK_T.getSelectedItem(), "Thông báo");
        DataValidator.validateEmptyMaKH(txt_ThongTinKhachHang, sb);
        int sLT;
        SanPhamDao daoSP = new SanPhamDao();
        SanPham SPT = new SanPham();
        for(int i = 0;i < text; i++)
        {
            sLT = (int) tbl_CTHD_LHD.getValueAt(i, 3);
            try {
                SPT = daoSP.find((String) tbl_CTHD_LHD.getValueAt(i, 1));
            } catch (Exception ex) {
                Logger.getLogger(LapHoaDonForm.class.getName()).log(Level.SEVERE, null, ex);
            }
            if(sLT>SPT.getSoLuong())
            {MessageDialogHelper.showErrorDialog(null,"Sản phẩm "+ SPT.getTenSP()+" có số lượng tồn không đủ ", "Lỗi");
                return;
            }
        }
        try {
            float TienKD = Float.valueOf(txt_KhachDua.getText());
            if(TienKD>0){
            float TienTra = TienKD - CapNhapThanhTien();
            if(TienTra>=0){
            lbl_GiaTriTL.setText(String.valueOf(TienTra));
            }else
            {MessageDialogHelper.showErrorDialog(null, "Tiền khách đưa chưa đủ", "Lỗi");
            lbl_GiaTriTL.setText("0");
            return;
            }
            }
            else{
            MessageDialogHelper.showErrorDialog(null, "Tiền khách đưa không được âm", "Lỗi");
            return;
            }
        } catch (Exception e) {
            MessageDialogHelper.showErrorDialog(null, "Vui lòng nhập lại tiền khách đưa", "Lỗi");
            return;
        }

        //DataValidator.validateEmptyChucVu(txt_ChucVu_T, sb);
        if (sb.length() > 0) {
            MessageDialogHelper.showErrorDialog(null, sb.toString(), "Lỗi");
            return;
        }

        try {
            HoaDon hd = new HoaDon();
            KhachHangDao daoKH = new KhachHangDao();
            hd.setMaHD(tuDongLayMaHD());
            long millis = System.currentTimeMillis();  
            java.sql.Date date=new java.sql.Date(millis);
            hd.setNgayLap(date);
            String[] maKH = txt_ThongTinKhachHang.getText().split("-");
            hd.setNhanVien(SharedData.nhanVienDN);
            hd.setKhachHang(daoKH.find(maKH[0]));
            hd.setTongTien(CapNhapThanhTien());
            hd.setGhiChu(txt_GhiChu.getText());
            HoaDonDao dao = new HoaDonDao();
            if (dao.insert(hd)&&insertCTHD(hd.getMaHD())) {
                
                MessageDialogHelper.showMessageDialog(null, "Thanh toán thành công, hóa đơn đã được lưu", "Thông báo");
                CapNhapLaiSP(hd.getMaHD());
                loadDataToTable();
                //
                setTTIn(hd.getMaHD());
                bHeight = Double.valueOf(chitiethoadon.size());
                //JOptionPane.showMessageDialog(rootPane, bHeight);
                PrinterJob pj = PrinterJob.getPrinterJob();
                pj.setPrintable(new BillPrintable(),getPageFormat(pj));
                try {
                pj.print();
                XoaTTIn();
                resetTTHD();
                }
                catch (PrinterException ex) {
                ex.printStackTrace();
                }
                //*/
                
            } else {
                MessageDialogHelper.showConfirmDialog(null, "Thanh toán không thành công do lỗi", "Cảnh báo");

            }
            
            
        } catch (Exception e) {
            e.printStackTrace();
            MessageDialogHelper.showErrorDialog(null, e.getMessage(),
                     "Lỗi");
        }
    }//GEN-LAST:event_btn_ThanhToanVaInActionPerformed

    public String tuDongLayMaQLKH() {
     String maKH = "";
		try {
			Connection con = ConnectDB.getInstance().getConnection();
			String sql = " DECLARE @ID VARCHAR(5)\r\n"
					+ " IF (SELECT COUNT(maKH) FROM KhachHang) = 0\r\n"
					+ " SET @ID = '0'\r\n" 
                                        + " ELSE\r\n"
					+ " SELECT @ID = MAX(RIGHT(rtrim(maKH), 3)) FROM KhachHang\r\n"
                                        + " SELECT @ID = CASE\r\n"
                                        + " WHEN @ID >= 0 and @ID < 9 THEN 'KH00' + CONVERT(CHAR, CONVERT(INT, @ID) + 1)\r\n"      
                                        + " WHEN @ID >= 9 THEN 'KH0' + CONVERT(CHAR, CONVERT(INT, @ID) + 1)\r\n"
                                        + " END\r\n"
                                        + " select @ID" ;       		
                                
			Statement statement = con.createStatement();
			ResultSet rs = statement.executeQuery(sql);
			while (rs.next()) {
				String ID = rs.getString(1);
				maKH = ID;
			}
		} catch (SQLException e) {
			// TODO: handle exception
			e.printStackTrace();
		}
		return maKH;
     
     }
    public String tuDongLayMaHD() {
     String maHD = "";
		try {
			Connection con = ConnectDB.getInstance().getConnection();
			String sql = " DECLARE @ID VARCHAR(7)\r\n"
					+ " IF (SELECT COUNT(maHD) FROM HoaDon) = 0\r\n"
					+ " SET @ID = '0'\r\n" 
                                        + " ELSE\r\n"
					+ " SELECT @ID = MAX(RIGHT(rtrim(maHD), 5)) FROM HoaDon\r\n"
                                        + " SELECT @ID = CASE\r\n"
                                        + " WHEN @ID >= 0 and @ID < 9 THEN 'HD0000' + CONVERT(CHAR, CONVERT(INT, @ID) + 1)\r\n"      
                                        + " WHEN @ID >= 9 THEN 'HD000' + CONVERT(CHAR, CONVERT(INT, @ID) + 1)\r\n"
                                        + " WHEN @ID >= 99 THEN 'HD00' + CONVERT(CHAR, CONVERT(INT, @ID) + 1)\r\n"
                                        + " WHEN @ID >= 999 THEN 'HD0' + CONVERT(CHAR, CONVERT(INT, @ID) + 1)\r\n"
                                        + " END\r\n"
                                        + " select @ID" ;       		
                                
			Statement statement = con.createStatement();
			ResultSet rs = statement.executeQuery(sql);
			while (rs.next()) {
				String ID = rs.getString(1);
				maHD = ID;
			}
		} catch (SQLException e) {
			// TODO: handle exception
			e.printStackTrace();
		}
		return maHD;
     
     }
    private void btn_ThongTinKhachHangActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_ThongTinKhachHangActionPerformed
        
        String regTT = "^[A-Z a-zÀÁÂÃÈÉÊÌÍÒÓÔÕÙÚÝàáâãèéêìíòóôõùúýĂăĐđĨĩŨũƠơƯưẠ-ỹ]+[-][0-9]+[-][0-9]+$";
        if(!txt_ThongTinKhachHang.getText().matches(regTT))
        {
             MessageDialogHelper.showErrorDialog(null, "Hãy nhập thông tin theo: Tên-Số điện thoại-Tuổi", "Lỗi");
            return;
        }
        String[]ThongTin = txt_ThongTinKhachHang.getText().split("-");
        String regTen = "^[A-Z a-zÀÁÂÃÈÉÊÌÍÒÓÔÕÙÚÝàáâãèéêìíòóôõùúýĂăĐđĨĩŨũƠơƯưẠ-ỹ]+$";
        String regSDT = "[0-9]{10}";
        
        //String regEmail = "^[_A-Za-z0-9-\\+]+(\\.[_A-Za-z0-9-]+)*@"+ "[A-Za-z0-9-]+(\\.[A-Za-z0-9]+)*(\\.[A-Za-z]{2,})$";
        //MessageDialogHelper.showMessageDialog(null, (String) cbx_MaTK_T.getSelectedItem(), "Thông báo");
        /*if(ThongTin[0]==null||ThongTin[1]==null||ThongTin[2]==null)
        {
        MessageDialogHelper.showErrorDialog(null, "Hãy nhập thông tin theo: Tên-Số điện thoại-Tuổi", "Lỗi");
        return;
        
        }*/
        if(!ThongTin[0].matches(regTen))
        {
             MessageDialogHelper.showErrorDialog(null, "Sai định dạng nhập lại tên", "Lỗi");
            return;
           
        }else if(!ThongTin[1].matches(regSDT))
        {
            MessageDialogHelper.showErrorDialog(null, "Sai định dạng nhập lại số điện thoại", "Lỗi");
            return;
        }
        
        try {
            int tuoi = Integer.parseInt(ThongTin[2]);
        } catch (Exception e) {
            MessageDialogHelper.showErrorDialog(null, "Sai định dạng nhập lại tuổi", "Lỗi");
            return;
        }
          //DataValidator.validateEmpty(sn_Tuoi_TKH2, sb, "Ngày sinh không được để trống và theo định dạng MM-dd-yyyy");
        //DataValidator.validateEmptyChucVu(txt_ChucVu_T, sb);
        

        try {
            KhachHang kh = new KhachHang();
            kh.setMaKH(tuDongLayMaQLKH());
            kh.setTenKH(ThongTin[0]);
            //kh.setDiaChi(ThongTin[1]);        
            kh.setsDT(ThongTin[1]);
            //kh.setEmail(ThongTin[3]);
            kh.setTuoi(Integer.parseInt( ThongTin[2]));
            

            KhachHangDao dao =new KhachHangDao();
            if(dao.insert(kh))
            {
                
                MessageDialogHelper.showMessageDialog(null, "Khách hàng thêm thành công", "Thông báo");
                txt_ThongTinKhachHang.setText(kh.getMaKH().replaceAll("\\s","")+"-"+kh.getTenKH());
            }
            else{
                MessageDialogHelper.showConfirmDialog(null, "khách hàng không lưu được do lỗi", "Cảnh báo");
            }

        } catch (Exception e) {
            e.printStackTrace();
            MessageDialogHelper.showErrorDialog( null, e.getMessage()
                , "Lỗi");
        }
    }//GEN-LAST:event_btn_ThongTinKhachHangActionPerformed

    private void btn_MayTinhActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_MayTinhActionPerformed
        MayTinhForm mayTinh = new MayTinhForm();
        mayTinh.setVisible(true);
    }//GEN-LAST:event_btn_MayTinhActionPerformed

    private void txt_DonGia_QLSPFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txt_DonGia_QLSPFocusGained
        txt_DonGia_QLSP.setBackground(Color.white); // TODO add your handling code here:
    }//GEN-LAST:event_txt_DonGia_QLSPFocusGained

    private void txt_DonGia_QLSPActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txt_DonGia_QLSPActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txt_DonGia_QLSPActionPerformed

    private void txt_MaSP_QLSPFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txt_MaSP_QLSPFocusGained
        txt_MaSP_QLSP.setBackground(Color.white); // TODO add your handling code here:
    }//GEN-LAST:event_txt_MaSP_QLSPFocusGained

    private void txt_MaSP_QLSPMouseExited(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_txt_MaSP_QLSPMouseExited
        
    }//GEN-LAST:event_txt_MaSP_QLSPMouseExited

    private void txt_TenSP_QLSPFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_txt_TenSP_QLSPFocusGained
        txt_TenSP_QLSP.setBackground(Color.white); // TODO add your handling code here:
    }//GEN-LAST:event_txt_TenSP_QLSPFocusGained

    private void cbx_ChonNhom_QLSPMouseMoved(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_cbx_ChonNhom_QLSPMouseMoved
        // TODO add your handling code here:
    }//GEN-LAST:event_cbx_ChonNhom_QLSPMouseMoved

    private void cbx_ChonNhom_QLSPFocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_cbx_ChonNhom_QLSPFocusGained

    }//GEN-LAST:event_cbx_ChonNhom_QLSPFocusGained

    private void cbx_ChonNhom_QLSPMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_cbx_ChonNhom_QLSPMouseClicked
        // TODO add your handling code here:
    }//GEN-LAST:event_cbx_ChonNhom_QLSPMouseClicked

    private void cbx_ChonNhom_QLSPMouseExited(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_cbx_ChonNhom_QLSPMouseExited

    }//GEN-LAST:event_cbx_ChonNhom_QLSPMouseExited

    private void cbx_ChonNhaCungCap_QLSPMouseExited(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_cbx_ChonNhaCungCap_QLSPMouseExited

        // TODO add your handling code here:
    }//GEN-LAST:event_cbx_ChonNhaCungCap_QLSPMouseExited

    private void cbx_ChonTacGia_QLSPMouseExited(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_cbx_ChonTacGia_QLSPMouseExited
        // TODO add your handling code here:
    }//GEN-LAST:event_cbx_ChonTacGia_QLSPMouseExited

    private void pn_TTSP_QLSPMouseMoved(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_pn_TTSP_QLSPMouseMoved
        // TODO add your handling code here:
    }//GEN-LAST:event_pn_TTSP_QLSPMouseMoved

    private void tbl_DanhSachSP_QLSPFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_tbl_DanhSachSP_QLSPFocusLost

    }//GEN-LAST:event_tbl_DanhSachSP_QLSPFocusLost
    private int findTT(String ma)
    {
        int tt = tbl_CTHD_LHD.getRowCount();
        String mass;
        //
        if(tt==0)
        {   
            return -1;
        }
        else{
            while(tt!=0)
            {
                //MessageDialogHelper.showConfirmDialog(null, String.valueOf(tt), "Cảnh báo");
                mass = (String) tbl_CTHD_LHD.getValueAt(tt-1, 1).toString();
                if(ma.equals(mass))
                {return tt;}
                else{tt--;}
            
            }
        }
        return -1;
        
    }
    private void tbl_DanhSachSP_QLSPMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tbl_DanhSachSP_QLSPMouseClicked
        if(evt.getClickCount()>=2)
        {
            
            try {
            int row = tbl_DanhSachSP_QLSP.getSelectedRow();
            String ma = (String) tbl_DanhSachSP_QLSP.getValueAt(row, 0);
            int sLT = (int) tbl_DanhSachSP_QLSP.getValueAt(row, 2);
            //
            if(sLT!=0){
            int find = findTT(ma);
            //
            if(find==-1)
            {
            int tt = tbl_CTHD_LHD.getRowCount()+1;
            
            String ten = (String) tbl_DanhSachSP_QLSP.getValueAt(row, 1);
            float donGia =  (float) tbl_DanhSachSP_QLSP.getValueAt(row, 3);
            float ThanhTien = donGia*1;
             JLabel lbl = (JLabel) tbl_DanhSachSP_QLSP.getValueAt(row, 4);
             
            //MessageDialogHelper.showConfirmDialog(null, ""+row, "Cảnh báo");
            tblModelCTHD.addRow(new Object[]{ tt,ma,ten, 1,donGia,ThanhTien,lbl });

                tblModelCTHD.fireTableDataChanged();
                CapNhapThanhTien();
            }else
            {
                int soluong = (int) tblModelCTHD.getValueAt(find-1, 3);
                int soluongsp = (int) tbl_DanhSachSP_QLSP.getValueAt(row, 2);
                if(soluongsp>soluong)
                {
                float donGia = (float) tblModelCTHD.getValueAt(find-1, 4);
                tblModelCTHD.setValueAt(soluong+1, find-1, 3);
                tblModelCTHD.setValueAt((soluong+1)*donGia, find-1, 5);
                CapNhapThanhTien();
                }else{MessageDialogHelper.showMessageDialog(null,"Số lượng sản phẩm đạt tối đa", "Thông báo");}
            }}else
            {MessageDialogHelper.showMessageDialog(null,"Sản phẩm hiện đã hết hàng", "Thông báo");}
        } catch (Exception e) {
            e.printStackTrace();
            JOptionPane.showMessageDialog(null, e.getStackTrace(),"Lỗi",JOptionPane.ERROR_MESSAGE);
        }
        
        }
        
        
    }//GEN-LAST:event_tbl_DanhSachSP_QLSPMouseClicked

    private void cbx_ChonNhom_QLSPActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbx_ChonNhom_QLSPActionPerformed
        
    }//GEN-LAST:event_cbx_ChonNhom_QLSPActionPerformed

    private void txt_ThongTinKhachHangActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txt_ThongTinKhachHangActionPerformed
       KhachHangDao daoKH = new KhachHangDao();
       String ThongTin = txt_ThongTinKhachHang.getText();
       String regMa = "^[K][H][0-9]{3}$";
       String regTen ="^[A-Z a-zÀÁÂÃÈÉÊÌÍÒÓÔÕÙÚÝàáâãèéêìíòóôõùúýĂăĐđĨĩŨũƠơƯưẠ-ỹ]+$";
       String regSDT ="[0-9]{10}";
       KhachHang kh = new KhachHang();
       if(ThongTin.matches(regMa))
       { 
           try {
               kh = daoKH.find(ThongTin);
               if(kh!=null)
               {txt_ThongTinKhachHang.setText("");
                   txt_ThongTinKhachHang.setText(kh.getMaKH().replaceAll("\\s","")+"-"+kh.getTenKH());}
               else{txt_ThongTinKhachHang.setText("");}
           } catch (Exception ex) {
               
           }
       }else if(ThongTin.matches(regSDT))
       {
           try {
           kh = daoKH.findSDT(ThongTin);
               if(kh!=null)
               {txt_ThongTinKhachHang.setText("");
                   txt_ThongTinKhachHang.setText(kh.getMaKH().replaceAll("\\s","")+"-"+kh.getTenKH());}
               
           } catch (Exception ex) {
               
           }
       }else if(ThongTin.matches(regTen))
       {
           try {
           kh = daoKH.findTen(ThongTin);
               if(kh!=null)
               {txt_ThongTinKhachHang.setText("");
                   txt_ThongTinKhachHang.setText(kh.getMaKH().replaceAll("\\s","")+"-"+kh.getTenKH());}
               
           } catch (Exception ex) {
               
           }
       }
       
    }//GEN-LAST:event_txt_ThongTinKhachHangActionPerformed

    private void txt_ThongTinKhachHangMouseExited(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_txt_ThongTinKhachHangMouseExited
       KhachHangDao daoKH = new KhachHangDao();
       String ThongTin = txt_ThongTinKhachHang.getText();
       String regMa = "^[K][H][0-9]{3}$";
       String regTen ="^[A-Z a-zÀÁÂÃÈÉÊÌÍÒÓÔÕÙÚÝàáâãèéêìíòóôõùúýĂăĐđĨĩŨũƠơƯưẠ-ỹ]+$";
       String regSDT ="[0-9]{10}";
       KhachHang kh = new KhachHang();
       if(ThongTin.matches(regMa))
       { 
           try {
               kh = daoKH.find(ThongTin);
               if(kh!=null)
               {txt_ThongTinKhachHang.setText("");
                   txt_ThongTinKhachHang.setText(kh.getMaKH().replaceAll("\\s","")+"-"+kh.getTenKH());}
               else{txt_ThongTinKhachHang.setText("");}
           } catch (Exception ex) {
               
           }
       }else if(ThongTin.matches(regSDT))
       {
           try {
           kh = daoKH.findSDT(ThongTin);
               if(kh!=null)
               {txt_ThongTinKhachHang.setText("");
                   txt_ThongTinKhachHang.setText(kh.getMaKH().replaceAll("\\s","")+"-"+kh.getTenKH());}
               
           } catch (Exception ex) {
               
           }
       }else if(ThongTin.matches(regTen))
       {
           try {
           kh = daoKH.findTen(ThongTin);
               if(kh!=null)
               {txt_ThongTinKhachHang.setText("");
                   txt_ThongTinKhachHang.setText(kh.getMaKH().replaceAll("\\s","")+"-"+kh.getTenKH());}
               
           } catch (Exception ex) {
               
           }
       }
    }//GEN-LAST:event_txt_ThongTinKhachHangMouseExited

    private void tbl_CTHD_LHDMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tbl_CTHD_LHDMouseClicked
        if(evt.getClickCount()>=2)
        {
            int soluong=0;
            try {
                 
               
                String sl = JOptionPane.showInputDialog("Nhập số lượng sản phẩm");
                 
                //MessageDialogHelper.showMessageDialog(null,sl, "Thông báo");
                 try {
                     if(!(sl.replaceAll("\\s", "").equals("")))
                {
                   
                soluong = Integer.parseInt(sl);
                int row = tbl_CTHD_LHD.getSelectedRow();
                SanPhamDao dao = new SanPhamDao();
                String ma = (String) tbl_CTHD_LHD.getValueAt(row, 1);
                 int soluongton=-1;
                try {
                    soluongton = dao.find(ma).getSoLuong();
                } catch (Exception ex) {
                    Logger.getLogger(LapHoaDonForm.class.getName()).log(Level.SEVERE, null, ex);
                }
                if(soluong>0){
                if(soluong<(soluongton+1))
                {
                    float donGia = (float) tblModelCTHD.getValueAt(row, 4);
                    tblModelCTHD.setValueAt(soluong, row, 3);
                    tblModelCTHD.setValueAt(donGia*soluong, row, 5);
                    CapNhapThanhTien();
            
                }else
                {MessageDialogHelper.showMessageDialog(null,"Vượt quá số lượng tồn của sản phẩm", "Thông báo");}
                }else
                {MessageDialogHelper.showMessageDialog(null,"Số lượng sản phẩm không được âm", "Thông báo");}
            
                }
                } catch (Exception e) {
                        return;
                    } 
            } catch (Exception e) {
                MessageDialogHelper.showErrorDialog(null,"Sai định dạng", "Lỗi");
            }
            
        }
    }//GEN-LAST:event_tbl_CTHD_LHDMouseClicked

    private void mni_Xoa_CTHDActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_mni_Xoa_CTHDActionPerformed
        DefaultTableModel tblModel2 = (DefaultTableModel) tbl_CTHD_LHD.getModel();
        int viTri =tbl_CTHD_LHD.getSelectedRow();
        if(viTri>=0)
        {
            tblModel2.removeRow(viTri);
            for(int i = 0 ;i< tbl_CTHD_LHD.getRowCount();i++)
            {
                tbl_CTHD_LHD.setValueAt(i+1, i, 0);
            }
        }
        CapNhapThanhTien();
    }//GEN-LAST:event_mni_Xoa_CTHDActionPerformed

    private void txt_KhachDuaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txt_KhachDuaActionPerformed
      String TienKDString = txt_KhachDua.getText();
      if(!TienKDString.equals("")){
        try {
            float TienKD = Float.valueOf(TienKDString);
            if(TienKD>0){
            float TienTra = TienKD - CapNhapThanhTien();
            if(TienTra>=0){
            lbl_GiaTriTL.setText(String.valueOf(TienTra));
            }else
            {MessageDialogHelper.showErrorDialog(null, "Tiền khách đưa chưa đủ", "Lỗi");
            lbl_GiaTriTL.setText("0");
            }
            }
            else{
            MessageDialogHelper.showErrorDialog(null, "Tiền khách đưa không được âm", "Lỗi");
            }
        } catch (Exception e) {
            MessageDialogHelper.showErrorDialog(null, "Sai định dạng", "Lỗi");
        }}
    }//GEN-LAST:event_txt_KhachDuaActionPerformed

    private void btn_TimKiemActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_TimKiemActionPerformed
        try {

            StringBuilder sb = new StringBuilder();
            //MessageDialogHelper.showMessageDialog(null, (String) cbx_MaTK_T.getSelectedItem(), "Thông báo");
            DataValidator.validateEmptyMaSP_TK(txt_MaSP_QLSP, sb);
            //DataValidator.validateEmptyTen_TK(txt_TenSP_QLSP, sb);
            DataValidator.validateEmptyDonGia_TK(txt_DonGia_QLSP, sb);

            //DataValidator.validateEmptyChucVu(txt_ChucVu_T, sb);
            if (sb.length() > 0) {
                MessageDialogHelper.showErrorDialog(null, sb.toString(), "Lỗi");
                return;
            }
            SanPhamDao dao = new SanPhamDao();
            NhomSanPhamDao daoNSP = new NhomSanPhamDao();
            NhaCungCapDao daoNCC = new NhaCungCapDao();
            TacGiaDao daoTG = new TacGiaDao();
            //

            //
            String[] NSP = cbx_ChonNhom_QLSP.getSelectedItem().toString().split("-");
            NhomSanPham textNSP = daoNSP.findMaNhomSPByTen(NSP[0]);
            String maNSP = "";
            if (!(NSP[0].equals("Chọn nhóm sản phẩm")||NSP[0].replaceAll("\\s", "").equals(""))) {
                
               if (textNSP != null) {
                    maNSP = textNSP.getMaNhomSP();
                } else {
                    MessageDialogHelper.showMessageDialog(null, "Nhóm sản phẩm không tồn tại", "Thông báo");
                    return;
                }
            }
            //
            String[] NCC = cbx_ChonNhaCungCap_QLSP.getSelectedItem().toString().split("-");
            NhaCungCap textNCC = daoNCC.findMaNhaCCByTen(NCC[0]);
            String maNCC = "";
            if (!(NCC[0].equals("Chọn nhà cung cấp")||NCC[0].replaceAll("\\s", "").equals(""))) {
                if (textNCC != null) {
                    maNCC = textNCC.getMaNhaCC();
                } else {
                    MessageDialogHelper.showMessageDialog(null, "Nhà cung cấp không tồn tại", "Thông báo");
                    return;
                }
            }

            //
            String[] TG = cbx_ChonTacGia_QLSP.getSelectedItem().toString().split("-");
            TacGia textTG = daoTG.findMaTacGiaByTen(TG[0]);
            String maTG = "";
            if (!(TG[0].equals("Chọn tác giả")||TG[0].replaceAll("\\s", "").equals(""))) {
                if (textTG != null) {
                    maTG = textTG.getMaTacGia();
                } else {
                    MessageDialogHelper.showMessageDialog(null, "Tác giả không tồn tại", "Thông báo");
                    return;
                }
            }
            //JOptionPane.showConfirmDialog(null, maNSP);
            List<SanPham> list = dao.findDK(txt_MaSP_QLSP.getText(), txt_TenSP_QLSP.getText(), txt_DonGia_QLSP.getText(), maNSP, maNCC, maTG);

            tblModel.setRowCount(0);
            for (SanPham it : list) {
                JLabel lbl = new JLabel();
                //MessageDialogHelper.showMessageDialog(null, it.getTinhTrang(), "Thông báo");
                ImageIcon icon = new ImageIcon();
                if (it.getHinhSP() != null) {
                    //Image img = ImageHelper.CreateImageFromByteArray(nv.getHinh(), "jpg");
                    //lbl_Hinh_CN.setIcon(new ImageIcon(img));
                    //personalImage = nv.getHinh();

                    icon = new ImageIcon(it.getHinhSP());
                    lbl.setIcon(icon);
                } else {
                    // personalImage = nv.getHinh();
                    //ImageIcon icon = new ImageIcon(getClass().getResource("/com/mycompany/quanlynhanvien/icons/Screenshot 2021-11-17 090047.jpg")); 
                    // lbl_Hinh_CN.setIcon(icon);
                    icon = new ImageIcon(getClass().getResource("/com/mycompany/quanlynhanvien/icons/Screenshot 2021-11-17 090047.jpg"));
                    lbl.setIcon(icon);

                }

                tblModel.addRow(new Object[]{it.getMaSP(), it.getTenSP(), it.getSoLuong(), it.getDonGia(), lbl});

                tblModel.fireTableDataChanged();
            }
        } catch (Exception e) {
            e.printStackTrace();
            MessageDialogHelper.showErrorDialog(null, e.getMessage(), "Lỗi");

        }
    }//GEN-LAST:event_btn_TimKiemActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JDialog XemCTHDForm;
    private javax.swing.JButton btn_Huy;
    private javax.swing.JButton btn_In;
    private javax.swing.JButton btn_MayTinh;
    private javax.swing.JButton btn_ThanhToan;
    private javax.swing.JButton btn_ThanhToanVaIn;
    private javax.swing.JButton btn_ThongTinKhachHang;
    private javax.swing.JButton btn_TimKiem;
    private javax.swing.JButton btn_XemTTHD;
    private javax.swing.JComboBox<String> cbx_ChonNhaCungCap_QLSP;
    private javax.swing.JComboBox<String> cbx_ChonNhom_QLSP;
    private javax.swing.JComboBox<String> cbx_ChonTacGia_QLSP;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    private javax.swing.JLabel lbl_DonGia_QLSP;
    private javax.swing.JLabel lbl_GhiChu;
    private javax.swing.JLabel lbl_GiaTriTL;
    private javax.swing.JLabel lbl_KhachDua;
    private javax.swing.JLabel lbl_KhachHang;
    private javax.swing.JLabel lbl_MaHD;
    private javax.swing.JLabel lbl_MaHD_XemCTHD;
    private javax.swing.JLabel lbl_MaNV_QLSP;
    private javax.swing.JLabel lbl_NgayLap;
    private javax.swing.JLabel lbl_NgayLap_XemCTHD;
    private javax.swing.JLabel lbl_NhaCC_QLSP;
    private javax.swing.JLabel lbl_NhomSP_QLSP;
    private javax.swing.JLabel lbl_TTKH_XemCTHD;
    private javax.swing.JLabel lbl_TTNV_XemCTHD;
    private javax.swing.JLabel lbl_TacGia_QLSP;
    private javax.swing.JLabel lbl_TenNV;
    private javax.swing.JLabel lbl_TenNV_QLSP;
    private javax.swing.JLabel lbl_ThanhTien_LHD;
    private javax.swing.JLabel lbl_TieuMaHD;
    private javax.swing.JLabel lbl_TieuNgayLap;
    private javax.swing.JLabel lbl_TieuTenNV;
    private javax.swing.JLabel lbl_TieuThanhTien;
    private javax.swing.JLabel lbl_TongTien_XemCTHD;
    private javax.swing.JLabel lbl_TraLai;
    private javax.swing.JMenuItem mni_Xoa_CTHD;
    private javax.swing.JPopupMenu pmn_CTHD_LHD;
    private javax.swing.JPanel pn_LapHD;
    private javax.swing.JPanel pn_TTSP_QLSP;
    private javax.swing.JPanel pn_ThongSoLHD;
    private javax.swing.JScrollPane scp_CTHD_LHD;
    private javax.swing.JScrollPane scp_DanhSachSP_QLSP;
    private javax.swing.JScrollPane sp_XemCTHD;
    private javax.swing.JTable tb_XemCTHD;
    private javax.swing.JTable tbl_CTHD_LHD;
    private javax.swing.JTable tbl_DanhSachSP_QLSP;
    private javax.swing.JTextField txt_DonGia_QLSP;
    private javax.swing.JTextField txt_GhiChu;
    private javax.swing.JTextField txt_KhachDua;
    private javax.swing.JTextField txt_MaSP_QLSP;
    private javax.swing.JTextField txt_TenSP_QLSP;
    private javax.swing.JTextField txt_ThongTinKhachHang;
    // End of variables declaration//GEN-END:variables
}
